<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recommended Recovery Programs</title>
  <link rel="stylesheet" href="/static/styles.css">
  <style>
    /* Additional styles specific to recommendations page */
    .program-card {
      background-color: var(--light-green);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
      transition: transform 0.2s;
    }
    
    .program-card:hover {
      transform: translateY(-5px);
    }
    
    .program-title {
      color: var(--primary-green);
      font-size: 1.5em;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .score-badge {
      display: inline-block;
      background: linear-gradient(to right, var(--primary-green), var(--primary-blue));
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-weight: bold;
      margin-left: 10px;
      font-size: 0.9em;
    }
    
    .program-description {
      color: var(--dark-gray);
      margin-bottom: 15px;
      line-height: 1.6;
    }
    
    .match-section {
      background-color: white;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    
    .match-heading {
      color: var(--primary-blue);
      font-size: 1.1em;
      margin-bottom: 8px;
    }
    
    .match-item {
      padding: 8px;
      border-left: 3px solid var(--primary-green);
      background-color: var(--light-gray);
      margin-bottom: 8px;
    }
    
    .program-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .program-detail {
      background-color: white;
      padding: 10px 12px;
      border-radius: 4px;
      font-size: 0.9em;
    }
    
    .detail-label {
      font-weight: bold;
      color: var(--primary-blue);
      display: block;
      margin-bottom: 5px;
    }
    
    .ranking-nav {
      display: flex;
      justify-content: center;
      margin: 20px 0;
      gap: 10px;
    }
    
    .ranking-btn {
      background: linear-gradient(to right, var(--primary-green), var(--primary-blue));
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .ranking-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .ranking-btn.active {
      background: var(--primary-green);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .filter-section {
      background-color: white;
      padding: 1.5rem;
      border-radius: 8px;
      margin: 20px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    
    .filter-title {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: var(--primary-green);
      font-weight: bold;
    }
    
    .filter-options {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .filter-row {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .filter-label {
      min-width: 200px;
    }
    
    #max-price {
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 100px;
    }
    
    .back-link {
      display: inline-block;
      margin-top: 20px;
      color: var(--primary-blue);
      text-decoration: none;
      font-weight: 500;
    }
    
    .back-link:hover {
      color: var(--accent-blue);
      text-decoration: underline;
    }
    
    .learn-more-btn {
      background: linear-gradient(to right, var(--primary-green), var(--primary-blue));
      color: white;
      text-decoration: none;
      padding: 0.75rem 1.5rem;
      border-radius: 4px;
      display: inline-block;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .learn-more-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* Classes for showing/hiding program cards */
    .program-list .program-card {
      display: none;
    }
    
    .program-list.show-top-3 .visible-program:nth-child(-n+3) {
      display: block;
    }
    
    .program-list.show-top-10 .visible-program:nth-child(-n+10) {
      display: block;
    }
    
    .program-list.show-all .visible-program {
      display: block;
    }
    
    .no-results {
      background-color: var(--light-blue);
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      color: var(--dark-gray);
      margin: 20px 0;
      display: none;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--light-green);
      border-radius: 50%;
      border-top-color: var(--primary-green);
      animation: spin 1s linear infinite;
    }
    
    .loading-text {
      margin-top: 15px;
      color: var(--primary-green);
      font-weight: bold;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    @media (max-width: 768px) {
      .program-details {
        grid-template-columns: 1fr;
      }
      
      .filter-options {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="wave-container">
      <h1>Your Recommended Recovery Programs</h1>
      <p class="tagline">Programs matched to your values and preferences</p>
      <div class="wave"></div>
    </div>
  </header>
  
  <nav class="main-nav">
    <div class="nav-container">
      <a href="/" class="nav-link">Home</a>
      <a href="/about" class="nav-link">About</a>
      <a href="/what-is-brain-retraining" class="nav-link">What is Brain Retraining</a>
      <a href="/my-story" class="nav-link">My Recovery Story</a>
      <a href="/contact" class="nav-link">Contact</a>
    </div>
  </nav>
  
  <div class="container">
    <div class="filter-section">
      <div class="filter-title">Filter Programs</div>
      <form id="filter-form">
        <div class="filter-options">
          <div class="filter-row">
            <span class="filter-label">Maximum Price ($):</span>
            <input type="number" id="max-price" name="max-price" value="{{ filters.max_price or '' }}" min="0">
          </div>
          
          <div class="filter-row">
            <span class="filter-label">Refund Policy or Free Trial:</span>
            <label class="toggle-switch">
              <input type="checkbox" id="refund-required" name="refund-required" {% if filters.refund %}checked{% endif %}>
              <span class="slider"></span>
            </label>
          </div>
          
          <div class="filter-row">
            <span class="filter-label">Financial Aid Available:</span>
            <label class="toggle-switch">
              <input type="checkbox" id="financial-aid-required" name="financial-aid-required" {% if filters.financial_aid %}checked{% endif %}>
              <span class="slider"></span>
            </label>
          </div>
          
          <div class="filter-row">
            <span class="filter-label">Coaching Options:</span>
            <label class="toggle-switch">
              <input type="checkbox" id="coaching-required" name="coaching-required" {% if filters.coaching %}checked{% endif %}>
              <span class="slider"></span>
            </label>
          </div>
          
          <div class="filter-row">
            <span class="filter-label">Community Element:</span>
            <label class="toggle-switch">
              <input type="checkbox" id="community-required" name="community-required" {% if filters.community %}checked{% endif %}>
              <span class="slider"></span>
            </label>
          </div>
          
          <div class="filter-row">
            <span class="filter-label">Forum Element:</span>
            <label class="toggle-switch">
              <input type="checkbox" id="forum-required" name="forum-required" {% if filters.forum %}checked{% endif %}>
              <span class="slider"></span>
            </label>
          </div>
        </div>
        
        <button type="button" id="apply-filters" class="ranking-btn">Apply Filters</button>
      </form>
    </div>
    
    <div class="ranking-nav">
      <button class="ranking-btn active" data-show="top-3">Top 3</button>
      <button class="ranking-btn" data-show="top-10">Top 10</button>
      <button class="ranking-btn" data-show="all">Show All</button>
    </div>
    
    <div class="no-results">
      <h3>No programs match your filter criteria</h3>
      <p>Try adjusting your filters to see more results.</p>
    </div>
    
    <div class="program-list show-top-3">
      {% for program in ranked_programs %}
      <div class="program-card" 
           data-price="{{ program.price }}"
           data-refund="{{ 'yes' if program.refund_policy else 'no' }}"
           data-financial-aid="{{ 'yes' if program.financial_aid else 'no' }}"
           data-coaching="{{ 'yes' if program.coaching else 'no' }}"
           data-forum="{{ 'yes' if program.forum else 'no' }}"
           data-community="{{ 'yes' if program.community else 'no' }}">
        <div class="program-title">{{ program.name }} <span class="score-badge">{{ program.score }}% Match</span></div>
        
        <div class="match-section">
          <div class="match-heading">Top Matches in Values & Perspective</div>
          <div class="match-item">
            <strong>You said:</strong> "{{ program.user_sentences[0] if program.user_sentences else '' }}"
          </div>
          <div class="match-item">
            <strong>{{ program.name }} says:</strong> "{{ program.program_sentences[0] if program.program_sentences else '' }}"
          </div>
          
          {% if program.user_sentences|length > 1 and program.program_sentences|length > 1 %}
          <div class="match-item">
            <strong>You said:</strong> "{{ program.user_sentences[1] }}"
          </div>
          <div class="match-item">
            <strong>{{ program.name }} says:</strong> "{{ program.program_sentences[1] }}"
          </div>
          {% endif %}
        </div>
        
        {% if program.description %}
        <div class="program-description">{{ program.description }}</div>
        {% endif %}
        
        <div class="program-details">
          <div class="program-detail">
            <span class="detail-label">Price</span>
            ${{ program.price }}
            {% if program.pricing_notes %}
            <div><small>{{ program.pricing_notes }}</small></div>
            {% endif %}
          </div>
          
          <div class="program-detail">
            <span class="detail-label">Refund Policy</span>
            {{ program.refund_policy if program.refund_policy else 'Not specified' }}
          </div>
          
          <div class="program-detail">
            <span class="detail-label">Coaching</span>
            {{ program.coaching }}
          </div>
          
          <div class="program-detail">
            <span class="detail-label">Forum</span>
            {{ program.forum }}
          </div>
          
          <div class="program-detail">
            <span class="detail-label">Community Element</span>
            {{ program.community }}
          </div>
          
          <div class="program-detail">
            <span class="detail-label">Financial Aid</span>
            {{ program.financial_aid }}
          </div>
        </div>
        
        <a href="{{ program.url }}" target="_blank" class="learn-more-btn">Visit Program Website</a>
      </div>
      {% endfor %}
    </div>
    
    <a href="survey.html" class="back-link">← Back to Survey</a>
  </div>
  
  <footer>
    <div class="footer-wave">
      <div class="wave wave-footer"></div>
      <div class="footer-content">
        <p>This website provides educational information only and is not a substitute for medical advice.</p>
      </div>
    </div>
  </footer>
  
  <script>
    
    // Handle showing different numbers of recommendations
    document.querySelectorAll('.ranking-btn').forEach(button => {
      button.addEventListener('click', function() {
        const showClass = this.getAttribute('data-show');
        
        // Update active button
        document.querySelectorAll('.ranking-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        this.classList.add('active');
        
        // Update visible programs
        const programList = document.querySelector('.program-list');
        programList.className = 'program-list';
        programList.classList.add('show-' + showClass);
        
        // After changing view, check if we need to show "no results" message
        checkNoResults();
      });
    });
    
    // Handle filtering programs
    document.getElementById('apply-filters').addEventListener('click', function() {
      const maxPrice = document.getElementById('max-price').value;
      const refundRequired = document.getElementById('refund-required').checked;
      const financialAidRequired = document.getElementById('financial-aid-required').checked;
      const coachingRequired = document.getElementById('coaching-required').checked;
      const forumRequired = document.getElementById('forum-required').checked;
      const communityRequired = document.getElementById('community-required').checked;
      
      // First hide all cards and remove the visible-program class
      document.querySelectorAll('.program-card').forEach(card => {
        card.style.display = 'none';
        card.classList.remove('visible-program');
      });
      
      // Then determine which cards should be visible based on filters
      let visibleCount = 0;
      document.querySelectorAll('.program-card').forEach(card => {
        let showCard = true;
        
        // Filter by price
        if (maxPrice && parseFloat(card.getAttribute('data-price')) > parseFloat(maxPrice)) {
          showCard = false;
        }
        
        // Filter by refund policy
        if (refundRequired && card.getAttribute('data-refund') !== 'yes') {
          showCard = false;
        }
        
        // Filter by financial aid
        if (financialAidRequired && card.getAttribute('data-financial-aid') !== 'yes') {
          showCard = false;
        }
        
        // Filter by coaching
        if (coachingRequired && card.getAttribute('data-coaching') !== 'yes') {
          showCard = false;
        }
        
        // Filter by forum
        if (forumRequired && card.getAttribute('data-forum') !== 'yes') {
          showCard = false;
        }
        
        // Filter by community
        if (communityRequired && card.getAttribute('data-community') !== 'yes') {
          showCard = false;
        }
        
        // Mark the card as a visible program if it passes all filters
        if (showCard) {
          card.classList.add('visible-program');
          visibleCount++;
        }
      });
      
      // Check for no results scenario
      checkNoResults();
      
      // Re-apply current view (top-3, top-10, all)
      const activeView = document.querySelector('.ranking-btn.active').getAttribute('data-show');
      const programList = document.querySelector('.program-list');
      programList.className = 'program-list';
      programList.classList.add('show-' + activeView);
    });
    
    function checkNoResults() {
      const visiblePrograms = document.querySelectorAll('.visible-program');
      const noResultsMessage = document.querySelector('.no-results');
      
      if (visiblePrograms.length === 0) {
        noResultsMessage.style.display = 'block';
      } else {
        noResultsMessage.style.display = 'none';
      }
    }
    
    // Initialize all cards as visible on page load
    document.querySelectorAll('.program-card').forEach(card => {
      card.classList.add('visible-program');
    });
  </script>
</body>
</html>