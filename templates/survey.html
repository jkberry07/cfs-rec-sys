<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ME/CFS Recovery Pathfinder - Survey</title>
  <link rel="stylesheet" href="/static/styles.css">
  <link rel="icon" type="image/png" href="/static/favicon.png">
</head>
<body>
  <header>
    <div class="wave-container">
      <h1>ME/CFS Program Finder</h1>
      <p class="tagline"></p>
      <div class="wave"></div>
    </div>
  </header>
    
  <nav class="main-nav">
    <div class="nav-container">
      <a href="/" class="nav-link">Home</a>
      <a href="/about" class="nav-link">About</a>
      <a href="/brain-retraining" class="nav-link">What is Brain Retraining</a>
      <a href="/my-story" class="nav-link">My Recovery Story</a>
      <a href="/contact" class="nav-link">Contact</a>
      <a href="/survey" class="nav-link start-survey">Start Survey</a>
    </div>
  </nav>
    
  <div class="container">
    <form action="/recommendations" method="post" class="survey-form">
      <section class="quiz-section">
        <h2>Short-Answer Questions</h2>
        <p>Answer at least one question, <b>focusing on what you would most like to see reflected in a recovery program</b>. Your answers will be compared with text from program websites to get an idea of which programs might be the best fit with your perspective and goals.</p>
        <p>After you submit the survey, you will be shown the top 3 programs based on your answers and filters, with links to the programs so you can learn more. <b>You will also have the option to see the full list of programs</b> ranked by how well they match your answers.</p>
        <p>Feel free to come back to the survey as many times as you like if the recommendations don't resonate with you. Play around with it. If you just want to see the programs by your filter settings, you can just ignore the rankings.</p>
        
        <!-- Question 1 -->
        <div class="question">
          <select id="question1" name="question1" class="question-select">
            <option value="">Select a question...</option>
            <option value="brain-retraining">What do you hope to gain from brain retraining, besides recovery? (RECOMMENDED)</option>
            <option value="learning">When you're learning a new skill, what helps you feel most confident and engaged in the process?</option>
            <option value="support">What types of support are you looking for from a program?</option>
            <option value="science">How important is scientific explanation to you, and why?</option>
            <option value="growth">How do you approach personal growth and development?</option>
            <option value="spiritual">Would you describe your recovery as a spiritual journey, and if so, why?</option>
            <option value="mind-body">What have you heard about mind-body approaches that most interests you?</option>
            <option value="motivation">What motivates you most when working toward a difficult goal?</option>
          </select>
          <textarea id="answer1" name="answer1" rows="4" placeholder="Your response..."></textarea>
        </div>
          
        <!-- Question 2 -->
        <div class="question">
          <select id="question2" name="question2" class="question-select">
            <option value="">Select a question...</option>
            <option value="brain-retraining">What do you hope to gain from brain retraining, besides recovery? (RECOMMENDED)</option>
            <option value="learning">When you're learning a new skill, what helps you feel most confident and engaged in the process?</option>
            <option value="support">What types of support are you looking for from a program?</option>
            <option value="science">How important is scientific explanation to you, and why?</option>
            <option value="growth">How do you approach personal growth and development?</option>
            <option value="spiritual">Would you describe your recovery as a spiritual journey, and if so, why?</option>
            <option value="mind-body">What have you heard about mind-body approaches that most interests you?</option>
            <option value="motivation">What motivates you most when working toward a difficult goal?</option>
          </select>
          <textarea id="answer2" name="answer2" rows="4" placeholder="Your response..."></textarea>
        </div>
        
        <!-- Question 3 -->
        <div class="question">
          <select id="question3" name="question3" class="question-select">
            <option value="">Select a question...</option>
            <option value="brain-retraining">What do you hope to gain from brain retraining, besides recovery? (RECOMMENDED)</option>
            <option value="learning">When you're learning a new skill, what helps you feel most confident and engaged in the process?</option>
            <option value="support">What types of support are you looking for from a program?</option>
            <option value="science">How important is scientific explanation to you, and why?</option>
            <option value="growth">How do you approach personal growth and development?</option>
            <option value="spiritual">Would you describe your recovery as a spiritual journey, and if so, why?</option>
            <option value="mind-body">What have you heard about mind-body approaches that most interests you?</option>
            <option value="motivation">What motivates you most when working toward a difficult goal?</option>
          </select>
          <textarea id="answer3" name="answer3" rows="4" placeholder="Your response..."></textarea>
        </div>
      </section>

      <section class="consent-section">
        <div class="consent-checkbox">
          <input type="checkbox" id="store-answers" name="store-answers" value="true">
          <label for="store-answers">
            <strong>OPTIONAL:</strong> Store my answers anonymously to help improve recommendations for future users.
          </label>
        </div>
      </section>
        
      <section class="filters">
        <h2>Program Filters</h2>
        <p>For programs that are paid monthly, the price shown is over the course of 6 months.</p>
        
        <div class="filter-options">
          <!-- Price Range -->
          <div class="filter-group">
            <div class="price-filter-container">
              <label for="max-price"><strong>Maximum Price ($, USD):</strong></label>
              
              <div class="price-display">
                  <span id="price-value">$1500+</span>
              </div>
              
              <div class="price-histogram" id="price-histogram">
                  <div class="histogram-bars" id="histogram-bars"></div>
              </div>
              
              <input type="range" id="max-price" name="max-price" class="price-slider" 
                    min="100" max="1500" value="1500" step="50">
              
              <div class="price-labels">
                  <span>$100</span>
                  <span>$1500+</span>
              </div>
              
              <div class="programs-count">
                  <span id="programs-count">All programs in price range</span>
              </div>
             </div>
            </div>
            
            <!-- Toggleable Filters -->
          <div class="filter-toggles">
            <!-- Refund Policy -->
            <div class="filter-row">
                <span class="filter-label">Refund Policy or Free Trial:</span>
                <label class="toggle-switch">
                    <input type="checkbox" name="refund" value="true">
                    <span class="slider"></span>
                </label>
                <span> </span>
            </div>
              
              <!-- Financial Aid -->
            <div class="filter-row">
                <span class="filter-label">Financial Aid Available:</span>
                <label class="toggle-switch">
                    <input type="checkbox" name="financial-aid" value="true">
                    <span class="slider"></span>
                </label>
                <span> </span>
            </div>
              
            <!-- Coaching Options -->
            <div class="filter-row">
                <span class="filter-label">Coaching Options:</span>
                <label class="toggle-switch">
                    <input type="checkbox" name="coaching" value="true">
                    <span class="slider"></span>
                </label>
                <span> </span>
            </div>
              
            <!-- Community Element -->
            <div class="filter-row">
              <span class="filter-label">Community Element:</span>
              <label class="toggle-switch">
                <input type="checkbox" name="community" value="true">
                <span class="slider"></span>
              </label>
              <span> </span>
            </div>
              
            <!-- Forum Element -->
            <div class="filter-row">
              <span class="filter-label">Forum Element:</span>
              <label class="toggle-switch">
                <input type="checkbox" name="forum" value="true">
                <span class="slider"></span>
              </label>
              <span> </span>
            </div>
          </div>
        </div>
      </section>
        
      <div class="submit-section">
          <button type="submit" class="submit-btn">Submit Responses</button>
      </div>
    </form>
  </div>
    
  <footer>
        <p>Disclaimer: The content in and throughout this website is for informational and educational purposes only, and is not a substitute for medical diagnosis, treatment or advice.</p>
        <p><a href = "/privacy" style="color: var(--light-green);">Privacy Statement</a> | <a href = "/contact" style="color: var(--light-green);">Contact</a></p>
      </footer>

  <script>

    //Set up for price histogram
    // @ts-nocheck
    const prices = {{ price_list | tojson }};
    let buckets = [];
    
    function createPriceHistogram() {
        const minPrice = 100;
        const maxPrice = Math.max(1500, Math.max(...prices));
        const bucketSize = 50;
        
        // Update slider max if needed
        document.getElementById('max-price').max = maxPrice;
        
        // Create buckets and count programs
        buckets = [];
        for (let i = minPrice; i < maxPrice; i += bucketSize) {
            const count = prices.filter(p => p >= i && p < i + bucketSize).length;
            buckets.push({ min: i, max: i + bucketSize - 1, count });
        }
        
        // Generate histogram bars
        const maxCount = Math.max(...buckets.map(b => b.count));
        const histogramBars = document.getElementById('histogram-bars');
        
        buckets.forEach(bucket => {
            const bar = document.createElement('div');
            bar.className = 'histogram-bar';
            bar.style.height = `${(bucket.count / maxCount) * 100}%`;
            bar.title = `$${bucket.min}-$${bucket.max}: ${bucket.count} programs`;
            histogramBars.appendChild(bar);
        });
    }
    
    function updateSliderDisplay() {
        const slider = document.getElementById('max-price');
        const currentValue = parseInt(slider.value);
        const maxValue = parseInt(slider.max);
        
        // Update price display
        const priceDisplay = document.getElementById('price-value');
        priceDisplay.textContent = currentValue >= maxValue ? `$${maxValue}+` : `$${currentValue}`;
        
        // Update histogram bars
        const bars = document.querySelectorAll('.histogram-bar');
        let eligiblePrograms = 0;
        
        buckets.forEach((bucket, index) => {
            if (bucket.max <= currentValue) {
                bars[index].classList.remove('inactive');
                eligiblePrograms += bucket.count;
            } else {
                bars[index].classList.add('inactive');
            }
        });
        
        // Update programs count
        const programsCount = document.getElementById('programs-count');
        if (currentValue >= maxValue) {
            programsCount.textContent = `All ${prices.length} programs in selected price range.`;
        } else {
            programsCount.textContent = `${eligiblePrograms} of ${prices.length} programs in selected price range.`;
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        createPriceHistogram();
        updateSliderDisplay();
        
        // Add slider event listener
        document.getElementById('max-price').addEventListener('input', updateSliderDisplay);
    });

      // Simple script to prevent duplicate question selections
    document.addEventListener('DOMContentLoaded', function() {
      const selects = [
        document.getElementById('question1'),
        document.getElementById('question2'),
        document.getElementById('question3')
      ];
        
      selects.forEach(select => {
        select.addEventListener('change', function() {
          const currentValue = this.value;
          if (!currentValue) return;
            
          // Disable this option in other selects
          selects.forEach(otherSelect => {
            if (otherSelect !== this) {
                  Array.from(otherSelect.options).forEach(option => {
                    if (option.value === currentValue && otherSelect.value !== currentValue) {
                        option.disabled = true;
                    }
                });
            }
          });
          
            // Re-enable all options that aren't selected in any dropdown
          const selectedValues = selects.map(s => s.value).filter(v => v);
          selects.forEach(s => {
            Array.from(s.options).forEach(option => {
              if (option.value && !selectedValues.includes(option.value) || option.value === s.value) {
                  option.disabled = false;
              }
            });
          });
        });
      });
    });


    // Handle page visibility change (detect when coming back from browser back button)
      document.addEventListener('visibilitychange', function() {
        if (!document.hidden && formSubmitted) {
          // Page became visible and form was previously submitted
          // Remove any loading overlays
          const overlay = document.querySelector('.loading-overlay');
          if (overlay) {
            overlay.remove();
          }
          formSubmitted = false;
        }
      });
      
      // Handle pageshow event (fires when page is loaded from cache)
      window.addEventListener('pageshow', function(event) {
        if (event.persisted) {
          // Page was loaded from cache (browser back button)
          const overlay = document.querySelector('.loading-overlay');
          if (overlay) {
            overlay.remove();
          }
          formSubmitted = false;
        }
      });
  </script>

<script>
  // Loading overlay functionality
  document.addEventListener('DOMContentLoaded', function() {
    const surveyForm = document.querySelector('.survey-form');
    
    if (surveyForm) {
      surveyForm.addEventListener('submit', function(e) {
        // Validate form before showing loading overlay
        const question1 = document.getElementById('question1').value;
        const answer1 = document.getElementById('answer1').value.trim();
        const question2 = document.getElementById('question2').value;
        const answer2 = document.getElementById('answer2').value.trim();
        const question3 = document.getElementById('question3').value;
        const answer3 = document.getElementById('answer3').value.trim();
        
        if ((!question1 || !answer1) && (!question2 || !answer2) && (!question3 || !answer3)) {
          e.preventDefault();
          alert('Please select and answer at least one question before submitting.');
          return;
        }
        
        // Create and show loading overlay
        const overlay = document.createElement('div');
        overlay.className = 'loading-overlay';
        
        const spinnerContainer = document.createElement('div');
        spinnerContainer.style.textAlign = 'center';
        
        const spinner = document.createElement('div');
        spinner.className = 'loading-spinner';
        
        const loadingText = document.createElement('div');
        loadingText.className = 'loading-text';
        loadingText.textContent = 'Generating recommendations...';
        
        spinnerContainer.appendChild(spinner);
        spinnerContainer.appendChild(loadingText);
        overlay.appendChild(spinnerContainer);
        document.body.appendChild(overlay);

        // Set a timeout to remove overlay if something goes wrong
          setTimeout(function() {
            if (overlay && overlay.parentNode) {
              overlay.remove();
              formSubmitted = false;
            }
          }, 60000); // 60 second timeout
      });
    }
  });
</script>
</body>
</html>